// –ì–ª–∞–≤–Ω—ã–π JavaScript —Ñ–∞–π–ª –¥–ª—è Zvonobot API Test

/**
 * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
 */
document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Zvonobot API Test...');
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
    initializePage();
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    setupEventListeners();
    
    console.log('‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ');
});

/**
 * –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
 */
function setupEventListeners() {
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º—ã –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
    const voiceForm = document.getElementById('voice-form');
    if (voiceForm) {
        voiceForm.addEventListener('submit', handleVoiceFormSubmit);
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º—ã SMS
    const smsForm = document.getElementById('sms-form');
    if (smsForm) {
        smsForm.addEventListener('submit', handleSmsFormSubmit);
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫
    setupButtonHandlers();
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Ç–∞–±–æ–≤
    setupTabHandlers();
}

/**
 * –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –¥–ª—è –∫–Ω–æ–ø–æ–∫
 */
function setupButtonHandlers() {
    // –ö–Ω–æ–ø–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API –∫–ª—é—á–∞
    const testApiKeyBtn = document.querySelector('button[onclick="testApiKey()"]');
    if (testApiKeyBtn) {
        testApiKeyBtn.addEventListener('click', testApiKey);
    }
    
    // –ö–Ω–æ–ø–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è
    const getUserProfileBtn = document.querySelector('button[onclick="getUserProfile()"]');
    if (getUserProfileBtn) {
        getUserProfileBtn.addEventListener('click', getUserProfile);
    }
    
    // –ö–Ω–æ–ø–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–º–µ—Ä–æ–≤
    const getOutgoingPhonesBtn = document.querySelector('button[onclick="getOutgoingPhones()"]');
    if (getOutgoingPhonesBtn) {
        getOutgoingPhonesBtn.addEventListener('click', getOutgoingPhones);
    }
    
    // –ö–Ω–æ–ø–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∞—É–¥–∏–æ
    const getRecordsBtn = document.querySelector('button[onclick="getRecords()"]');
    if (getRecordsBtn) {
        getRecordsBtn.addEventListener('click', getRecords);
    }
    
    // –ö–Ω–æ–ø–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è SMS
    const testSmsBtn = document.querySelector('button[onclick="testSms()"]');
    if (testSmsBtn) {
        testSmsBtn.addEventListener('click', testSms);
    }
}

/**
 * –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –¥–ª—è —Ç–∞–±–æ–≤
 */
function setupTabHandlers() {
    const tabs = document.querySelectorAll('.tab');
    tabs.forEach(tab => {
        tab.addEventListener('click', function() {
            const tabName = this.getAttribute('onclick').match(/'([^']+)'/)[1];
            switchTab(tabName);
        });
    });
}

/**
 * –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –æ—à–∏–±–æ–∫
 */
window.addEventListener('error', function(event) {
    console.error('üö® –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞ JavaScript:', event.error);
    showResult(`‚ùå –û—à–∏–±–∫–∞ JavaScript: ${event.error.message}`, 'error');
});

window.addEventListener('unhandledrejection', function(event) {
    console.error('üö® –ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –ø—Ä–æ–º–∏—Å–∞:', event.reason);
    showResult(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–º–∏—Å–∞: ${event.reason}`, 'error');
});

/**
 * –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ (—Ç–æ–ª—å–∫–æ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
 */
function debugInfo() {
    console.log('üîç –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:');
    console.log('- API Base URL:', API_BASE_URL);
    console.log('- –¢–µ–∫—É—â–∏–π –∞–∫—Ç–∏–≤–Ω—ã–π —Ç–∞–±:', document.querySelector('.tab.active')?.textContent);
    console.log('- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–æ—Ä–º:', document.querySelectorAll('form').length);
    console.log('- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–Ω–æ–ø–æ–∫:', document.querySelectorAll('button').length);
}

// –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
window.switchTab = switchTab;
window.testApiKey = testApiKey;
window.getUserProfile = getUserProfile;
window.getOutgoingPhones = getOutgoingPhones;
window.getRecords = getRecords;
window.testSms = testSms;
window.debugInfo = debugInfo; 